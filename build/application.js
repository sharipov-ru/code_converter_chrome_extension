// Generated by CoffeeScript 1.3.3
(function() {
  var Application, Clipboard, Converter, applcation,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  Application = (function() {

    function Application() {
      this.setupContextMenus = __bind(this.setupContextMenus, this);
      this.setupContextMenus();
      this.converter = new Converter();
    }

    Application.prototype.setupContextMenus = function() {
      var hamlMenu, sassMenu, scssMenu,
        _this = this;
      hamlMenu = chrome.contextMenus.create({
        title: "Copy as Haml",
        contexts: ["selection"],
        onclick: function(info, tab) {
          return _this.converter.html2haml(info.selectionText);
        }
      });
      sassMenu = chrome.contextMenus.create({
        title: "Copy as SASS",
        contexts: ["selection"],
        onclick: function(info, tab) {
          return _this.converter.css2sass(info.selectionText, "SASS");
        }
      });
      scssMenu = chrome.contextMenus.create({
        title: "Copy as SCSS",
        contexts: ["selection"],
        onclick: function(info, tab) {
          return _this.converter.css2sass(info.selectionText, "SCSS");
        }
      });
      return sassMenu = chrome.contextMenus.create({
        title: "Copy as Coffescript",
        contexts: ["selection"],
        onclick: function(info, tab) {
          return _this.converter.js2coffee(info.selectionText);
        }
      });
    };

    return Application;

  })();

  Converter = (function() {

    function Converter() {
      this.js2coffee = __bind(this.js2coffee, this);

      this.css2sass = __bind(this.css2sass, this);

      this.html2haml = __bind(this.html2haml, this);

    }

    Converter.prototype.html2haml = function(selectedText) {
      var htmlSample;
      htmlSample = "{page: {html: '" + selectedText + "'}}";
      return $.ajax({
        url: "http://html2haml.heroku.com/api.json",
        type: "POST",
        data: htmlSample,
        dataType: "json",
        success: function(data) {
          var clipboard;
          alert(data.page.haml);
          clipboard = new Clipboard();
          return clipboard.copy(data.page.haml);
        },
        error: function(data) {
          return alert('haml converting error');
        }
      });
    };

    Converter.prototype.css2sass = function(selectedText, sassType) {
      return $.ajax({
        url: "http://css2sass.heroku.com/json",
        type: "POST",
        data: {
          page: {
            css: selectedText
          },
          commit: "Convert 2" + " " + sassType
        },
        dataType: "json",
        success: function(data) {
          var clipboard;
          alert(data.page.sass);
          clipboard = new Clipboard();
          return clipboard.copy(data.page.sass);
        },
        error: function(data) {
          return alert('saas converting error');
        }
      });
    };

    Converter.prototype.js2coffee = function(selectedText) {
      return $.ajax({
        url: "http://git.rordev.ru:8080/convert",
        type: "POST",
        data: {
          js: selectedText
        },
        dataType: "json",
        success: function(data) {
          var clipboard;
          alert(data.coffee);
          clipboard = new Clipboard();
          return clipboard.copy(data.coffee);
        },
        error: function(data) {
          return alert('coffescript converting error');
        }
      });
    };

    return Converter;

  })();

  Clipboard = (function() {

    function Clipboard() {
      this.copy = __bind(this.copy, this);
      this.document = document;
      this.from = $('<textarea/>');
      this.body = $('body');
    }

    Clipboard.prototype.copy = function(text) {
      this.from.text(text);
      this.body.append(this.from);
      this.from.select();
      this.document.execCommand('copy');
      return this.from.remove();
    };

    return Clipboard;

  })();

  applcation = new Application();

}).call(this);
